FROM rust:1.85-bookworm AS builder

ARG TARGET=x86_64-unknown-linux-gnu
WORKDIR /app

COPY Cargo.toml Cargo.toml
COPY src src

RUN rustup target add ${TARGET} \
    && cargo build --release --target ${TARGET}

RUN mkdir -p /out \
    && cp target/${TARGET}/release/rs-peer-workspace-server* /out/

CMD ["/bin/bash", "-lc", "ls -lah /out && echo Built target: ${TARGET}"]
